<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Letters </title>
  <meta name="description" content="Interactive apology page : letters, video, playful animations." />
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Inter:wght@400;600;800&family=Crimson+Pro:ital,wght@0,400;0,600;1,500&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#fff4fb; --ink:#222; --muted:#666;
      --rose:#ff6b81; --rose-deep:#e63946;
      --parchment:#fffaf0; --card:#fff;
      --shadow: 0 18px 60px rgba(0,0,0,.10);
      --soft-shadow: 0 8px 28px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;background:
      radial-gradient(800px 400px at 5% -10%, #fff0f6, transparent), linear-gradient(180deg,#fff,#fffaf7);color:var(--ink)}
    a{color:inherit}

    header{padding:18px 16px;position:sticky;top:0;background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.8));backdrop-filter: blur(6px);border-bottom:1px solid rgba(255,220,235,.6);z-index:6}
    .brand{max-width:1100px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:12px}
    #brandTitle{font-family:"Great Vibes",cursive;font-size:1.8rem;color:var(--rose-deep);margin:0}
    .subtitle{color:var(--muted);font-size:.95rem}

    .btn{background:linear-gradient(180deg,#fff,#fffafc);border:1px solid rgba(0,0,0,.06);padding:8px 14px;border-radius:999px;cursor:pointer;box-shadow:var(--soft-shadow);font-weight:700}
    .container{max-width:1100px;margin:0 auto;padding:22px}
    .block{margin:30px 0;padding:18px;border-radius:14px;background:var(--card);box-shadow:var(--shadow)}
    .section-title{display:flex;align-items:center;justify-content:center;margin-bottom:12px}
    .section-title h2{font-family:"Crimson Pro",serif;font-size:1.25rem;color:var(--rose-deep);margin:0}

    /* sparkles (subtle) */
    .sparkles{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden}
    .spark{position:absolute;border-radius:50%;background:linear-gradient(180deg,#fff,#ffd1e0);opacity:.9;filter:blur(.6px)}

    /* DIL (portrait centered) */
    .dil-wrap{display:grid;place-items:center}
    .dil-player{width:100%;max-width:420px;aspect-ratio:9/16;border-radius:14px;overflow:hidden;box-shadow:0 24px 60px rgba(230,60,100,.06);margin:0 auto;background:#000;border:6px solid rgba(255,230,240,.6)}
    .dil-player video{width:100%;height:100%;object-fit:cover;display:block}

    /* Theater */
    .theater-wrap .screen{border-radius:12px;overflow:hidden;background:#000;box-shadow:0 24px 80px rgba(0,0,0,.16);padding:6px}
    .media-frame{width:100%;height:56.25vw;max-height:60vh;border:0;display:block}

    /* POOP area - IMPORTANT: face-wrap has position:relative for proper placement */
    .poop-area{display:grid;gap:12px;padding:18px;align-items:center}
    .face-wrap{position:relative;max-width:520px;margin:0 auto;display:flex;justify-content:center;min-height:240px}
    .face-img{width:300px;height:300px;border-radius:12px;object-fit:cover;display:block;box-shadow:var(--soft-shadow);cursor:pointer;user-select:none}
    .poop-button{background:linear-gradient(180deg,#ffd65e,#ffb703);border:none;padding:12px 16px;border-radius:12px;font-weight:800;cursor:pointer;box-shadow:var(--soft-shadow)}
    .poop-emoji{position:absolute;font-size:64px;line-height:1;pointer-events:none;user-select:none;z-index:999;will-change:transform,opacity;filter:drop-shadow(0 12px 26px rgba(0,0,0,.18));opacity:0}
    .shake{animation:shake .32s ease-in-out}
    @keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-8px)}50%{transform:translateX(8px)}75%{transform:translateX(-6px)}100%{transform:translateX(0)}}

    /* Envelope / Letters UI */
    .letter-area{display:flex;flex-direction:column;align-items:center;gap:12px}
    #letterHeadline{cursor:pointer;display:inline-block;padding:8px 14px;border-radius:999px;background:linear-gradient(180deg,#fff,#fffaf6);box-shadow:var(--soft-shadow);font-weight:800;color:var(--rose-deep)}
    .letter-tabs{display:flex;gap:8px;margin-top:10px}
    .letter-tab{padding:8px 12px;border-radius:999px;background:linear-gradient(180deg,#fff,#fffaf6);border:1px solid #ffdfe9;cursor:pointer;font-weight:700;color:#a62b6a}
    .letter-tab[aria-selected="true"]{outline:2px solid #ffc2d6;background:linear-gradient(180deg,#ffe6ef,#fff)}
    .envelope-viewport{width:360px;height:340px;perspective:1200px;margin-top:10px}
    .envelope{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform .9s cubic-bezier(.2,.9,.2,1);cursor:pointer}
    .envelope .face,.envelope .back{position:absolute;inset:0;border-radius:12px;display:grid;place-items:center;font-weight:800}
    .envelope .face{backface-visibility:hidden;background:linear-gradient(180deg,#ffdfe9,#fff);color:var(--rose-deep)}
    .envelope .back{transform:rotateY(180deg);backface-visibility:hidden;background:linear-gradient(180deg,#fff6fa,#fff);padding:14px;overflow:auto;color:#333}
    .envelope.enter{animation:bounceIn .7s both}
    @keyframes bounceIn{0%{transform:translateY(-40vh) scale(.6) rotate(-6deg)}60%{transform:translateY(10px) scale(1.02)}100%{transform:translateY(0) scale(1) rotate(0)}}
    .envelope.flipped{transform:rotateY(180deg)}
    .letter-sheet{position:absolute;width:86%;left:7%;top:62%;transform:translateY(18px);background:var(--parchment);padding:18px;border-radius:10px;box-shadow:0 18px 40px rgba(0,0,0,.12);opacity:0;transition:transform .6s,opacity .6s;font-family:"Crimson Pro",serif}
    .letter-sheet.visible{opacity:1;transform:translateY(-120px)}
    .stamp{position:absolute;top:8px;right:10px;border:2px dashed rgba(166,43,106,.35);padding:6px 10px;border-radius:6px;font-size:.8rem;color:#a62b6a;background:#fff8fc}
    .letter-meta{display:flex;justify-content:space-between;color:#a0777a;margin-bottom:8px;font-weight:700}
    .letter-title{font-family:"Great Vibes",cursive;font-size:1.6rem;margin-bottom:6px;color:#a8334a;text-align:center}
    .letter-content{max-height:210px;overflow:auto;padding-right:8px}
    .signature{margin-top:10px;text-align:right;font-family:"Great Vibes",cursive;color:#a8334a;font-size:1.2rem}
    .letter-text-line{opacity:0;transform:translateY(8px);transition:opacity .45s ease,transform .45s ease}

    .editor-ui{display:flex;flex-direction:column;gap:8px;margin-top:12px;width:92%}
    textarea.editor{width:100%;min-height:160px;padding:12px;border-radius:8px;border:1px solid #ffdfe9;font-family:Georgia,serif;font-size:1rem}

    @media (max-width:880px){
      .dil-player{max-width:320px}
      .face-img{width:220px;height:220px}
      .envelope-viewport{width:88%;height:300px}
    }
    @media (prefers-reduced-motion: reduce){*{transition:none!important;animation:none!important}}
  </style>
</head>

<body>
  <div class="sparkles" id="sparkles" aria-hidden="true"></div>

  <header>
    <div class="brand container">
      <div>
        <h1 id="brandTitle">From the Stupidest Donkey Alive‚Ä¶</h1>
        <div class="subtitle muted">A small interactive page ‚Äî open letters when you're ready.</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn" id="editToggle" aria-pressed="false">‚úèÔ∏è Edit: Off</button>
        <button class="btn" id="resetAll">‚Ü∫ Reset</button>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- DIL (portrait) -->
    <section class="block dil-wrap" id="dilSection" aria-labelledby="dilTitle">
      <div class="section-title"><h2 id="dilTitle">üíì Dil Ka Jo Haal Hai</h2></div>
      <div class="dil-player" id="dilPlayer">
        <video id="dilVideo" playsinline preload="metadata" controls>
          <source src="DilKaHaal.mp4" type="video/mp4">
          Your browser doesn't support this video.
        </video>
      </div>
    </section>

    <!-- THEATER -->
    <section class="block theater-wrap" id="theaterSection" aria-labelledby="theaterTitle">
      <div class="section-title"><h2 id="theaterTitle">üé¨ Perfect Together ‚Äî The Short Film</h2></div>
      <div class="screen" id="screen">
        <iframe id="perfectFrame" class="media-frame" src="https://drive.google.com/file/d/1EwD4pr9sEOEdrvRQwVl-eoyAsDWJH0fg/preview" allow="autoplay; fullscreen" allowfullscreen title="Perfect Together (Drive Embed)"></iframe>
      </div>
    </section>

    <!-- POOP -->
    <section class="block poop-area" id="poopSection" aria-labelledby="poopTitle">
      <div class="section-title"><h2 id="poopTitle">üí© Poop My Face (for fun)</h2></div>
      <div class="face-wrap" id="faceWrap">
        <!-- kept your original photo path unchanged -->
        <img id="faceImg" class="face-img" src="donkeyLove.jpg" alt="Face image">
      </div>

      <div style="display:flex;gap:10px;justify-content:center;margin-top:10px">
        <button class="poop-button" id="poopBtn">Throw Poop!</button>
        <button class="poop-button" id="rapidPoop">Rapid Poops</button>
      </div>
    </section>

    <!-- LETTERS -->
    <section class="block letter-area" id="lettersSection" aria-labelledby="lettersTitle">
      <div class="section-title"><h2 id="lettersTitle">üíå The 3 Letters</h2></div>

      <div class="center" style="display:flex;flex-direction:column;align-items:center;gap:10px;">
        <div id="letterHeadline" role="button" tabindex="0" aria-pressed="false">Click to reveal the envelope</div>

        <div class="letter-tabs" id="letterTabs" style="display:none" role="tablist" aria-label="Choose a letter">
          <button class="letter-tab" role="tab" id="tab-1" aria-selected="true" data-index="0">Letter 1</button>
          <button class="letter-tab" role="tab" id="tab-2" aria-selected="false" data-index="1">Letter 2</button>
          <button class="letter-tab" role="tab" id="tab-3" aria-selected="false" data-index="2">Letter 3</button>
        </div>

        <div class="envelope-viewport" id="envelopeViewport" aria-hidden="true" style="display:none">
          <div class="envelope enter" id="envelope" role="button" tabindex="0" aria-label="Envelope ‚Äî click to open">
            <div class="face">üì© Open Me</div>
            <div class="back">Envelope back</div>

            <div class="letter-sheet" id="letterSheet" aria-hidden="true">
              <div class="stamp">Love Mail</div>
              <div class="letter-meta"><span id="letterCount">Letter 1 of 3</span><span>for Ishani</span></div>
              <div class="letter-title" id="letterTitle">To the Moon and Back</div>
              <div class="letter-content" id="letterContent"><!-- populated by JS --></div>
              <div class="signature" id="letterSignature">‚Äî Yours, always</div>
              <div class="wax-seal" aria-hidden="true" style="position:absolute;right:-6px;bottom:-6px;width:56px;height:56px;border-radius:999px;background:radial-gradient(circle at 30% 30%, #d63b57, #b61d3a);display:flex;align-items:center;justify-content:center;color:#fff;font-size:20px;">‚ù§</div>
            </div>
          </div>
        </div>

        <div class="letter-cta" id="letterCta" style="display:none">
          <button class="btn" id="prevLetter">‚¨ÖÔ∏è Previous</button>
          <button class="btn" id="nextLetter">Next ‚û°Ô∏è</button>
        </div>

        <div class="editor-ui" id="editorUI" style="display:none">
          <label class="muted">Edit selected letter (saved in your browser only):</label>
          <textarea id="letterEditor" class="editor" placeholder="Edit the visible letter here and click Save."></textarea>
          <div style="display:flex;gap:8px;justify-content:center">
            <button class="btn" id="saveLetter">Save</button>
            <button class="btn" id="resetLetter">Reset current</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer style="padding:26px;text-align:center;opacity:.85">Made with too much love (and tiny donkey energy) ü´è</footer>

  <script>
    /* ---------------- helpers ---------------- */
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => [...root.querySelectorAll(sel)];
    const rand = (min, max) => Math.random()*(max-min)+min;

    /* ---------------- sparkles ---------------- */
    (function spawnSparkles(){
      const root = $('#sparkles');
      if(!root) return;
      for(let i=0;i<12;i++){
        const d = document.createElement('div');
        d.className = 'spark';
        const size = 6 + Math.random()*16;
        d.style.width = d.style.height = size+'px';
        d.style.left = Math.random()*100 + '%';
        d.style.top = Math.random()*100 + '%';
        d.style.opacity = (0.04 + Math.random()*0.4);
        root.appendChild(d);
        d.animate([{transform:'translateY(0)', opacity:d.style.opacity},{transform:'translateY(-40px)', opacity:0}], {duration: 3000+Math.random()*6000, iterations: Infinity, direction:'alternate', easing:'ease-in-out'});
      }
    })();

    /* ---------------- DIL: reveal on view ---------------- */
    (function initDil(){
      const dil = $('#dilPlayer');
      const v = $('#dilVideo');
      if(!dil) return;
      const obs = new IntersectionObserver(entries=>{
        entries.forEach(e=> { if(e.isIntersecting) dil.classList.add('visible'); });
      }, {threshold:.28});
      obs.observe($('#dilSection'));
    })();

    /* ---------------- THEATER placeholder ---------------- */
    (function initTheater(){
      const screen = $('#screen');
      if(!screen) return;
      // intentionally minimal: clicking the screen does nothing harmful; user can click iframe controls
    })();

    /* ---------------- POOP feature (fixed) ---------------- */
    const faceWrap = $('#faceWrap');
    const faceImg = $('#faceImg');
    const poopBtn = $('#poopBtn');
    const rapidPoop = $('#rapidPoop');
    const poopSection = $('#poopSection');
    let rapidInterval = null;

    function createPoopAtClient(clientX, clientY){
      if(!faceWrap) return;
      const rect = faceWrap.getBoundingClientRect();
      const size = 64;
      // compute local coords relative to faceWrap (use client coords)
      const localX = (typeof clientX === 'number') ? (clientX - rect.left - size/2) : (rect.width/2 - size/2 + rand(-40,40));
      const localY = (typeof clientY === 'number') ? (clientY - rect.top - size/2) : (rect.height/2 - size/2 + rand(-40,40));

      const p = document.createElement('div');
      p.className = 'poop-emoji';
      p.textContent = 'üí©';
      p.style.left = `${localX}px`;
      p.style.top  = `${localY}px`;
      p.style.transform = `translateY(-180px) rotate(${rand(-30,30)}deg) scale(.6)`;
      p.style.opacity = '0';
      p.style.willChange = 'transform,opacity';
      faceWrap.appendChild(p);

      // animate in (drop)
      requestAnimationFrame(()=>{
        p.style.transition = 'transform 420ms cubic-bezier(.2,.9,.2,1), opacity 260ms';
        p.style.opacity = '1';
        p.style.transform = `translateY(0px) rotate(${360 + rand(0,360)}deg) scale(1)`;
      });

      // squish and small waft after drop
      setTimeout(()=>{
        p.style.transition = 'transform 300ms ease-out, opacity 420ms linear';
        p.style.transform = `translateY(-8px) rotate(12deg) scale(.88)`;

        // small waft lines (purely visual)
        for(let i=0;i<2;i++){
          const w = document.createElement('div');
          w.style.position='absolute';
          w.style.left = `${localX + rand(12,42)}px`;
          w.style.top = `${localY - rand(6,16)}px`;
          w.style.width = '2px'; w.style.height = '18px';
          w.style.borderRadius = '2px';
          w.style.background = 'linear-gradient(180deg,#8b5b2e,#8b5b2e00)';
          w.style.opacity = '0.45';
          w.style.pointerEvents = 'none';
          faceWrap.appendChild(w);
          w.animate([{transform:'translateY(12px)',opacity:.45},{transform:'translateY(-12px)',opacity:0}],{duration:1200,easing:'ease-out',fill:'forwards'});
          setTimeout(()=> w.remove(), 1400);
        }
      }, 520);

      // fade + remove
      setTimeout(()=> {
        p.style.opacity = '0';
        setTimeout(()=> { try{ p.remove(); } catch(_){} }, 480);
      }, 1400);
    }

    function throwPoopAtEvent(e){
      // prefer client coords (works for mouse & touch)
      let cx = null, cy = null;
      if(e.touches && e.touches[0]) { cx = e.touches[0].clientX; cy = e.touches[0].clientY; }
      else if(typeof e.clientX === 'number') { cx = e.clientX; cy = e.clientY; }
      createPoopAtClient(cx, cy);
      if(poopSection){ poopSection.classList.add('shake'); setTimeout(()=> poopSection.classList.remove('shake'), 320); }
    }

    // click/touch on face image -> throw at that point
    if(faceImg){
      faceImg.addEventListener('click', (e)=> { e.preventDefault(); throwPoopAtEvent(e); });
      faceImg.addEventListener('touchstart', (e)=> { e.preventDefault(); throwPoopAtEvent(e); }, {passive:false});
    }

    // Throw Poop button -> throw at a random point inside face area (centerish)
    if(poopBtn){
      poopBtn.addEventListener('click', ()=> {
        const rect = faceWrap.getBoundingClientRect();
        const cx = rect.left + rect.width/2 + rand(-40,40);
        const cy = rect.top  + rect.height/2 + rand(-40,40);
        createPoopAtClient(cx - window.scrollX, cy - window.scrollY); // client coords expected
        if(poopSection){ poopSection.classList.add('shake'); setTimeout(()=> poopSection.classList.remove('shake'), 320); }
      });
    }

    // Rapid Poops: hold to rapid-fire (mousedown/touchstart) and release to stop
    if(rapidPoop){
      rapidPoop.addEventListener('mousedown', ()=> {
        if(rapidInterval) return;
        rapidInterval = setInterval(()=> {
          const rect = faceWrap.getBoundingClientRect();
          const cx = rect.left + rand(20, rect.width-20);
          const cy = rect.top  + rand(20, rect.height-20);
          createPoopAtClient(cx, cy);
        }, 170);
      });
      document.addEventListener('mouseup', ()=> { if(rapidInterval){ clearInterval(rapidInterval); rapidInterval=null; } });

      rapidPoop.addEventListener('touchstart', (e)=> {
        if(rapidInterval) return;
        rapidInterval = setInterval(()=> {
          const rect = faceWrap.getBoundingClientRect();
          const cx = rect.left + rand(20, rect.width-20);
          const cy = rect.top  + rand(20, rect.height-20);
          createPoopAtClient(cx, cy);
        }, 170);
      }, {passive:false});
      document.addEventListener('touchend', ()=> { if(rapidInterval){ clearInterval(rapidInterval); rapidInterval=null; } });

      // also support quick click burst
      rapidPoop.addEventListener('click', ()=> {
        let n=8;
        const t = setInterval(()=> {
          const rect = faceWrap.getBoundingClientRect();
          const cx = rect.left + rand(20, rect.width-20);
          const cy = rect.top  + rand(20, rect.height-20);
          createPoopAtClient(cx, cy);
          if(--n<=0) clearInterval(t);
        }, 110);
      });
    }

    /* ---------------- LETTERS content (verbatim preserved) ---------------- */
    const LETTERS = [
      {
        title: "To the Moon and Back",
        signature: "‚Äî Yours, always",
        html: `
          <div class="letter-text-line">
          I love you to the moon and back Baby there is no limit to how much I love you and sometimes words feel too small to explain it. But still I want you to know that my love for you is endless. When I say I love you to the moon and back it‚Äôs not just a line it‚Äôs the truth of my heart. I love you everthing about you you're smile, you're eyes, you're lips, you're voice I love everything that you do I love you I love you so much that even if I tried to count it would never end. From the moment I wake up till the time I close my eyes at night tum mere dil mein ho. Every heartbeat is a reminder that I‚Äôm made to love you. Baby no distance no fight no sadness can ever change how much I love you. My love for you grows every single day and I know it will keep growing forever. So when I say I love you to the moon and back it means that even if the world ends my love for you will still remain. Ishani You asked me once why I chose you and my answer is simple because nothing has ever felt more real you are a place for my heart to rest, the hand I reach for in dark and light. Loving you wasn't a decision, it was something I realized I had already done.I love you and I'll never in this life love anyone else ever again you're going to be my last love and I'll always love you. I love you to the moon and back and much much more baby to infinity and beyond............
          </div>
        `
      },
      {
        title: "Some of the Reasons I Love You",
        signature: "‚Äî Forever yours",
        html: `
          <ul>
            <li class="letter-text-line">I love the way tum mera naam pyaar se bolte ho.</li>
            <li class="letter-text-line">I love jab tum bina wajah mujhe irritate karte ho bas meri reaction dekhne ke liye.</li>
            <li class="letter-text-line">I love the way tum gussa karte ho aur phir khud hi pighal jaate ho.</li>
            <li class="letter-text-line">I love ki tum mere har stupid joke pe bhi hasta dete ho.</li>
            <li class="letter-text-line">I love how tum mujhe samajh jaate ho bina main kuch bolun.</li>
            <li class="letter-text-line">I love ki tum meri silence ko bhi feel kar lete ho.</li>
            <li class="letter-text-line">I love jab tum randomly bol dete ho ‚ÄúI love you‚Äù bina reason ke.</li>
            <li class="letter-text-line">I love ki tum raat ko sirf meri awaaz sunane ke liye call karte ho.</li>
            <li class="letter-text-line">I love the way tum mujhe apna best friend aur lover dono banake rakhte ho.</li>
            <li class="letter-text-line">I love ki tum kabhi kabhi mummy ki tarah mujhe daant dete ho.</li>
            <li class="letter-text-line">I love jab tum meri care karte ho jaise main sabse special hoon.</li>
            <li class="letter-text-line">I love ki tum din mein 100 baar poochte ho ‚Äúkhana khaya na.‚Äù</li>
            <li class="letter-text-line">I love ki tum mujhe hamesha priority dete ho.</li>
            <li class="letter-text-line">I love the way tum mujhe motivate karte ho jab main give up karne lagta hoon.</li>
            <li class="letter-text-line">I love ki tum apne sapne mere saath share karte ho.</li>
            <li class="letter-text-line">I love ki tum apne har chhoti badi baat mujhe batana pasand karte ho.</li>
            <li class="letter-text-line">I love jab tum khud ke jokes pe khud hi haste ho.</li>
            <li class="letter-text-line">I love the way tum gussa hone ke baad chup ho jaate ho aur mujhe tension dete ho.</li>
            <li class="letter-text-line">I love jab tum bolte ho ‚Äúmujhe abhi chocolate chahiye.‚Äù</li>
            <li class="letter-text-line">I love ki tum mujhe apni diary ki tarah treat karte ho.</li>
            <li class="letter-text-line">I love jab tum ignore karne ka drama karte ho.</li>
            <li class="letter-text-line">I love the way tum possessive hoke bolte ho ‚Äútum sirf mere ho.‚Äù</li>
            <li class="letter-text-line">I love jab tum bolte ho ki ‚Äúmain tumhare bina reh nahi sakti.‚Äù</li>
            <li class="letter-text-line">I love jab tum mujhe tease karte ho hasi hasi mein.</li>
            <li class="letter-text-line">I love ki tum mujhe hamesha confident feel karate ho.</li>
            <li class="letter-text-line">I love jab tum apne future ke plans mein mujhe include karte ho.</li>
            <li class="letter-text-line">I love the way tum mujhe hug karte ho jaise main poori duniya hoon tumhari.</li>
            <li class="letter-text-line">I love ki tum mere bina ek din bhi reh nahi paate aur turant miss karte ho.</li>
            <li class="letter-text-line">I love the way tum ‚Äúbaby‚Äù bolte ho aur mera din ban jaata hai.</li>
            <li class="letter-text-line">I love ki tum mujhe kabhi baccha treat karte ho aur kabhi ek strong banda.</li>
            <li class="letter-text-line">I love jab tum apna gussa sirf mujhpe nikalte ho aur dusron pe nahi.</li>
            <li class="letter-text-line">I love ki tum mere messages ka reply fast dete ho chahe busy ho.</li>
            <li class="letter-text-line">I love jab tum bolte ho ‚Äútum mere ho aur bas mere hi rahoge.‚Äù</li>
            <li class="letter-text-line">I love ki tum mujhe bina try kiye special feel karate ho.</li>
            <li class="letter-text-line">I love jab tum attitude dikhate ho bas mujhe tang karne ke liye.</li>
            <li class="letter-text-line">I love jab tum chhoti si compliment dete ho aur main blush karne lagta hoon.</li>
            <li class="letter-text-line">I love jab tum randomly bol dete ho ki ‚Äúmujhe tumhari yaad aa rahi hai.‚Äù</li>
            <li class="letter-text-line">I love ki tum mujhe apne phone aur secrets trust karke dete ho.</li>
            <li class="letter-text-line">I love the way tum mujhe apna safe space banate ho.</li>
            <li class="letter-text-line">I love jab tum apni selfies bhejte ho sirf meri reaction ke liye.</li>
            <li class="letter-text-line">I love jab tum mujhe ‚Äúpagal‚Äù bolke hasi nikalte ho.</li>
            <li class="letter-text-line">I love ki tum mujhe apna sabse close person mante ho.</li>
            <li class="letter-text-line">I love the way tum mujhe har situation mein support karte ho.</li>
            <li class="letter-text-line">I love jab tum apni problems mujhe batate ho bina jhijhak.</li>
            <li class="letter-text-line">I love ki tum mujhe hamesha believe karte ho.</li>
            <li class="letter-text-line">I love jab tum chhoti si jealousy dikhate ho.</li>
            <li class="letter-text-line">I love jab tum mera mood instantly change kar dete ho.</li>
            <li class="letter-text-line">I love jab tum mujhse apna favourite song share karte ho.</li>
            <li class="letter-text-line">I love ki tum meri har baat seriously lete ho.</li>
            <li class="letter-text-line">I love the way tum mere liye effort karte ho.</li>
            <li class="letter-text-line">I love jab tum mujhe apni shopping choices mein involve karte ho.</li>
            <li class="letter-text-line">I love jab tum mujhe bolte ho ki main tumhari jaan hoon.</li>
            <li class="letter-text-line">I love ki tum hamesha meri izzat karte ho.</li>
            <li class="letter-text-line">I love jab tum mujhe apni chhoti chhoti khushiyan share karte ho.</li>
            <li class="letter-text-line">I love jab tum mujhe bina wajah miss karte ho.</li>
            <li class="letter-text-line">I love ki tum mujhe har galti ke baad maaf kar dete ho.</li>
            <li class="letter-text-line">I love jab tum mujhe apna lucky charm mante ho.</li>
            <li class="letter-text-line">I love ki tum hamesha mujhe better banne ke liye push karte ho.</li>
            <li class="letter-text-line">I love jab tum mujhe chhoti chhoti surprises dete ho.</li>
            <li class="letter-text-line">I love jab tum mujhe apni life ka best part bolte ho.</li>
            <li class="letter-text-line">I love ki tum meri care karte ho jaise main tumhara baby hoon.</li>
            <li class="letter-text-line">I love jab tum mujhe bina reason hugs dete ho.</li>
            <li class="letter-text-line">I love jab tum mere liye cute sa gussa karte ho.</li>
            <li class="letter-text-line">I love ki tum mujhe apna first priority mante ho.</li>
            <li class="letter-text-line">I love jab tum mere saath apni funny childhood stories share karte ho.</li>
            <li class="letter-text-line">I love jab tum mujhe respect ke saath pyaar karte ho.</li>
            <li class="letter-text-line">I love ki tum meri kamiya bhi accept karte ho.</li>
            <li class="letter-text-line">I love jab tum mujhe ‚Äúmeri jaan‚Äù bolte ho.</li>
            <li class="letter-text-line">I love jab tum mujhe inspire karte ho.</li>
            <li class="letter-text-line">I love ki tum hamesha mere side pe khade hote ho no matter what.</li>
            <li class="letter-text-line">I love jab tum mujhe suljhate ho jab main confuse hota hoon.</li>
            <li class="letter-text-line">I love ki tum mujhe kabhi akela feel nahi karne dete.</li>
            <li class="letter-text-line">I love jab tum mujhe apni diary ke jaise treat karte ho.</li>
            <li class="letter-text-line">I love ki tum mujhe hamesha apna best dikhana chahte ho.</li>
            <li class="letter-text-line">I love jab tum mujhe phone karke bas chup rehte ho.</li>
            <li class="letter-text-line">I love ki tum meri life mein hamesha honesty leke aaye ho.</li>
            <li class="letter-text-line">I love jab tum mujhe pyaar se tang karte ho.</li>
            <li class="letter-text-line">I love ki tum meri aankhon mein dekh kar sab samajh jaate ho.</li>
            <li class="letter-text-line">I love jab tum meri family ke saath bhi pyar se behave karte ho.</li>
            <li class="letter-text-line">I love ki tum mujhe har din naya pyaar feel karate ho.</li>
            <li class="letter-text-line">I love jab tum mujhe apne liye perfect mante ho.</li>
            <li class="letter-text-line">I love ki tum meri duniya ho.</li>
            <li class="letter-text-line">I love jab tum mujhe apna forever bolte ho.</li>
            <li class="letter-text-line">I love ki tum mere har dukh ko apna bana lete ho.</li>
            <li class="letter-text-line">I love jab tum mujhe apne favourite person bolte ho.</li>
            <li class="letter-text-line">I love ki tum meri life ka sabse acha decision ho.</li>
            <li class="letter-text-line">I love jab tum mujhe raat ko goodnight wish karte ho.</li>
            <li class="letter-text-line">I love ki tum meri subah ka reason ho smile karne ka.</li>
            <li class="letter-text-line">I love jab tum mujhe apna soulmate mante ho.</li>
            <li class="letter-text-line">I love ki tum meri har heartbeat mein ho.</li>
            <li class="letter-text-line">I love jab tum mujhe khud pe proud feel karwate ho.</li>
            <li class="letter-text-line">I love you because tum meri zindagi ka sabse beautiful gift ho.</li>
          </ul>
        `
      },
      {
        title: "I‚Äôm Sorry Baby",
        signature: "‚Äî I‚Äôll always try harder",
        html: `
          <div class="letter-text-line">
          I just want to say I‚Äôm really really sorry. I know I make mistakes and i'm literally the stupidest person in this world currently but trust me I never want to hurt you. Tum meri sabse special cheez ho hai aur main hamesha bas yahi chahta hoon ki tum khush raho whatever it may take I promise I‚Äôll be better. I‚Äôll learn from every mistake and make sure I never repeat it again. Main kuch bhi karunga bas taaki tum smile karo I love you're smile and I can do whatevr it takes to see that. I wish Ishani that you could see yourself from my eyes honestly you'd fall head over heels for yourself Ishani ik I fall short to show you how much you mean to me and I'm really sorry for that ik you feel like you have to ask things from me and then only it gets done and that i don't do anything from my end Ishani I'm really really sorry for that there's honestly no explanation for my wrongdoing except that i'm the world's biggest idiot keeping the most beautiful girl n this wole wide world sad and Ishani ik i just say it but i will spend the rest of my time in this world with the only thing i treasure and that's you and I'll make sure that you know that You deserve all the love and happiness in the world and I‚Äôll do everything I can to give that to you. Please forgive me baby. I love you endlessly and I‚Äôll always keep trying to be the best for you.
          </div>
        `
      }
    ];

    /* ---------------- Letters UI & logic ---------------- */
    const letterHeadline = $('#letterHeadline');
    const letterTabs = $('#letterTabs');
    const envelopeViewport = $('#envelopeViewport');
    const envelope = $('#envelope');
    const letterSheet = $('#letterSheet');
    const letterContent = $('#letterContent');
    const letterTitle = $('#letterTitle');
    const letterCount = $('#letterCount');
    const letterSignature = $('#letterSignature');
    const prevBtn = $('#prevLetter');
    const nextBtn = $('#nextLetter');
    const editorUI = $('#editorUI');
    const letterEditor = $('#letterEditor');
    const saveLetterBtn = $('#saveLetter');
    const resetLetterBtn = $('#resetLetter');
    const editToggle = $('#editToggle');
    const resetAllBtn = $('#resetAll');

    const STORAGE_KEYS = ['forgive_letter_1','forgive_letter_2','forgive_letter_3'];
    let currentLetter = 0;
    let flipped = false;

    // restore saved HTML if present
    LETTERS.forEach((L, idx)=> {
      const s = localStorage.getItem(STORAGE_KEYS[idx]);
      if(s && s.trim()) L.html = s;
    });

    // init tabs text & indices (keeps order stable)
    function initTabs(){
      $$('.letter-tab').forEach((b, idx)=> {
        b.dataset.index = String(idx);
        b.textContent = `Letter ${idx+1}`;
        b.setAttribute('aria-selected', String(idx===currentLetter));
      });
    }
    initTabs();

    function setTabActive(i){
      $$('.letter-tab').forEach((b, idx)=> b.setAttribute('aria-selected', String(idx===i)));
    }

    function renderLetter(i){
      const L = LETTERS[i];
      letterTitle.textContent = L.title;
      letterSignature.textContent = L.signature;
      letterCount.textContent = `Letter ${i+1} of ${LETTERS.length}`;
      letterContent.innerHTML = L.html;
      letterEditor.value = L.html;
      setTabActive(i);
      // reveal .letter-text-line inside the new content
      const nodes = $$('.letter-text-line', letterContent);
      nodes.forEach((n, idx)=> {
        n.style.opacity='0'; n.style.transform='translateY(6px)';
        setTimeout(()=> { n.style.opacity='1'; n.style.transform='translateY(0)'; }, 120 + idx*80);
      });
    }

    letterHeadline.addEventListener('click', ()=> {
      letterTabs.style.display = 'flex';
      envelopeViewport.style.display = 'block';
      renderLetter(currentLetter);
      setTimeout(()=> envelope.classList.add('enter'), 20);
    });
    letterHeadline.addEventListener('keydown', (e)=> { if(e.key==='Enter' || e.key===' ') { e.preventDefault(); letterHeadline.click(); } });

    letterTabs.addEventListener('click', (e)=> {
      const btn = e.target.closest('.letter-tab');
      if(!btn) return;
      currentLetter = Number(btn.dataset.index||0);
      renderLetter(currentLetter);
    });

    prevBtn.addEventListener('click', ()=> { currentLetter = (currentLetter + LETTERS.length - 1) % LETTERS.length; renderLetter(currentLetter); });
    nextBtn.addEventListener('click', ()=> { currentLetter = (currentLetter + 1) % LETTERS.length; renderLetter(currentLetter); });

    function flipEnvelope(){
      flipped = !flipped;
      if(flipped){
        envelope.classList.add('flipped');
        setTimeout(()=> {
          letterSheet.classList.add('visible');
          const nodes = $$('.letter-text-line', letterSheet);
          nodes.forEach((n, idx)=> setTimeout(()=> { n.style.opacity='1'; n.style.transform='translateY(0)'; }, 130 + idx*120));
        }, 420);
      } else {
        letterSheet.classList.remove('visible');
        $$('.letter-text-line', letterSheet).forEach(n=> { n.style.opacity='0'; n.style.transform='translateY(6px)'; });
        setTimeout(()=> envelope.classList.remove('flipped'), 200);
      }
    }
    envelope.addEventListener('click', flipEnvelope);
    envelope.addEventListener('keydown', (e)=> { if(e.key==='Enter' || e.key===' ') { e.preventDefault(); flipEnvelope(); } });

    // Save / reset
    saveLetterBtn.addEventListener('click', ()=> {
      const val = letterEditor.value || '';
      localStorage.setItem(STORAGE_KEYS[currentLetter], val);
      LETTERS[currentLetter].html = val;
      renderLetter(currentLetter);
      alert('Saved in your browser ‚úîÔ∏è');
    });
    resetLetterBtn.addEventListener('click', ()=> {
      if(confirm('Reset just this letter to original (clear saved content)?')){
        localStorage.removeItem(STORAGE_KEYS[currentLetter]);
        location.reload();
      }
    });

    // global edit toggle
    editToggle.addEventListener('click', ()=> {
      const on = editToggle.getAttribute('aria-pressed') === 'true';
      editToggle.setAttribute('aria-pressed', String(!on));
      editToggle.textContent = `‚úèÔ∏è Edit: ${!on ? 'On' : 'Off'}`;
      editorUI.style.display = !on ? 'block' : 'none';
    });

    // reset all saved
    resetAllBtn.addEventListener('click', ()=> {
      if(confirm('Reset everything saved for this page? This will clear the saved letters.')) {
        STORAGE_KEYS.forEach(k=> localStorage.removeItem(k));
        location.reload();
      }
    });

    // keyboard quick-open L
    document.addEventListener('keydown', (e)=> {
      if(e.key.toLowerCase() === 'l'){
        letterHeadline.click();
        if(!flipped) setTimeout(()=> flipEnvelope(), 600);
      }
    });

    // Pause videos on unload
    window.addEventListener('beforeunload', ()=> { $$('video').forEach(v=> { try{ v.pause(); } catch(_){} }); });

    // initial setup
    window.addEventListener('load', ()=> {
      initTabs();
      // ensure dil visible if in view
      const dil = $('#dilPlayer');
      if(dil){
        const r = dil.getBoundingClientRect();
        if(r.top < window.innerHeight) dil.classList.add('visible');
      }
    });
  </script>
</body>
</html>
