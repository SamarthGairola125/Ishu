<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>7 Letters ‚Äî Forgive Me</title>
  <meta name="description" content="Interactive apology page ‚Äî letters, videos, playful animations." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Inter:wght@400;600;800&family=Crimson+Pro:ital,wght@0,400;0,600;1,500&display=swap" rel="stylesheet">
  <style>
    /* -------------------- Reset & base -------------------- */
    :root{
      --bg:#fff4fb;
      --ink:#222;
      --muted:#666;
      --rose:#ff6b81;
      --rose-deep:#e63946;
      --glass: rgba(255,255,255,0.6);
      --accent:#ffd1e0;
      --card:#fff;
      --shadow: 0 12px 40px rgba(0,0,0,.12);
      --soft-shadow: 0 6px 18px rgba(0,0,0,.08);
      --parchment:#fffaf0;
      --seal:#b61d3a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:
        radial-gradient(800px 400px at 5% -10%, #fff0f6, transparent),
        linear-gradient(180deg,#fff,#fffaf7);
      color:var(--ink);
      -webkit-font-smoothing:antialiased;
      overflow-x:hidden;
      scroll-behavior:smooth;
    }
    .container{max-width:1100px;margin:0 auto;padding:28px}
    h1,h2{margin:0 0 12px 0}
    p{margin:0 0 12px 0}
    .center{text-align:center}
    .muted{color:var(--muted)}
    button{font-weight:700}
    /* small shiny buttons */
    .btn{
      background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
      border:1px solid rgba(0,0,0,0.06);
      padding:10px 14px;border-radius:999px;cursor:pointer;
      box-shadow:var(--soft-shadow);
    }
    .btn:hover{transform:translateY(-3px);transition:transform .2s}

    /* -------------------- floating sparkles -------------------- */
    .sparkles{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden}
    .spark{position:absolute;width:10px;height:10px;border-radius:50%;background:linear-gradient(180deg,#fff,#ffd1e0);opacity:.9;filter:blur(.6px);transform:translateY(10vh);}

    /* -------------------- header / headline -------------------- */
    header{padding:18px 12px 6px;z-index:2}
    .brand{max-width:1100px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand h1{font-size:clamp(1.2rem,2.4vw,1.8rem);color:var(--rose-deep);cursor:pointer;display:inline-block;animation:glow 2.6s infinite;user-select:none}
    @keyframes glow{
      0%{text-shadow:0 0 0 rgba(230,60,100,0)}
      50%{text-shadow:0 10px 30px rgba(230,60,100,.14)}
      100%{text-shadow:0 0 0 rgba(230,60,100,0)}
    }
    .subtitle{color:var(--muted);font-size:.95rem}

    /* -------------------- sections -------------------- */
    section.block{margin:24px auto;padding:18px;border-radius:18px;background:linear-gradient(180deg,var(--card),#fffafc);box-shadow:var(--shadow);position:relative;z-index:2}
    .section-title{display:flex;align-items:center;gap:12px;justify-content:center;margin-bottom:12px}
    .section-title h2{font-size:1.25rem;color:var(--rose-deep);margin:0}

    /* -------------------- DONKEY photo (fun) -------------------- */
    .donkey {display:grid;grid-template-columns:1fr;align-items:center;gap:12px;padding:20px;}
    .donkey-card{position:relative;overflow:hidden;border-radius:18px;padding:12px;background:linear-gradient(180deg,#fff,#fff9fb);box-shadow:0 18px 40px rgba(0,0,0,.08)}
    .donkey-img{width:100%;height:480px;max-height:64vh;object-fit:cover;border-radius:12px;transform-origin:center center;opacity:0;transform:scale(1.06);transition:transform .9s cubic-bezier(.2,.9,.2,1),opacity .9s}
    .donkey-img.loaded{opacity:1;transform:scale(1);}
    .donkey-img:hover{transform:scale(1.02) rotate(-1deg) translateY(-4px)}
    /* little hearts near donkey */
    .donkey-heart{position:absolute;pointer-events:none;right:20px;bottom:20px;font-size:28px;opacity:.95;transform:translateY(20px);animation:pop 1.6s infinite ease-in-out;}
    @keyframes pop{0%{transform:translateY(0) scale(.95)}50%{transform:translateY(-8px) scale(1.05)}100%{transform:translateY(0) scale(.95)}}

    /* -------------------- DIL KA HAAL (romantic) -------------------- */
    .dil-wrap{display:grid;grid-template-columns:1fr;gap:18px;align-items:center;padding:20px}
    .heart-frame{position:relative;border-radius:20px;padding:12px;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .heart-bg{position:absolute;inset:0;background:radial-gradient(circle at 20% 20%, rgba(246, 187, 208, .12), transparent 15%);pointer-events:none}
    .dil-player{
      position:relative;z-index:3;width:100%;max-width:920px;border-radius:14px;overflow:hidden;box-shadow:0 20px 60px rgba(230,60,100,.08);
      transform:translateY(20px);opacity:0;transition:transform .8s ease,opacity .8s;
      border:6px solid rgba(255,230,240,.6);
      background:#000;
    }
    .dil-player.visible{transform:translateY(0);opacity:1}
    /* pulsing heart border */
    .heart-pulse{position:absolute;inset:-8px;border-radius:26px;pointer-events:none;box-shadow:0 0 0 0 rgba(230,60,100,0.08);animation:beat 1.6s infinite;mix-blend-mode:screen}
    @keyframes beat{
      0%{box-shadow:0 0 0 0 rgba(230,60,100,.08)}
      40%{box-shadow:0 0 30px 8px rgba(230,60,100,.08)}
      100%{box-shadow:0 0 0 0 rgba(230,60,100,.08)}
    }
    .music-note{position:absolute;width:24px;height:24px;opacity:.12;filter:blur(.6px)}

    /* -------------------- THEATER (Perfect Together) -------------------- */
    .theater-wrap{position:relative;padding:0 12px}
    .curtains{position:relative;height:0;overflow:visible}
    .curtain{position:absolute;top:-8px;width:50%;height:260px;background:linear-gradient(180deg,#a62b6a,#6b1239);transform-origin:top;box-shadow:inset 0 -30px 40px rgba(0,0,0,.25);border-radius:0 0 120px 120px;transition:transform 1s cubic-bezier(.2,.9,.2,1)}
    .curtain.left{left:0;transform:translateX(-6%) skewX(-6deg)}
    .curtain.right{right:0;transform:translateX(6%) skewX(6deg)}
    .curtain.open.left{transform:translateX(-120%) skewX(-6deg)}
    .curtain.open.right{transform:translateX(120%) skewX(6deg)}
    .screen{margin-top:18px;border-radius:14px;overflow:hidden;background:#000;padding:8px;box-shadow:0 30px 80px rgba(0,0,0,.28)}
    /* make both <video> and <iframe> supported */
    .screen .media-frame{display:block;width:100%;height:60vh;max-height:420px;object-fit:cover;opacity:0;transform:scale(.98);transition:opacity .8s,transform .8s;border:0}
    .screen.visible .media-frame{opacity:1;transform:scale(1)}

    .popcorn{position:absolute;pointer-events:none;opacity:.12}

    /* -------------------- PIE (silly) -------------------- */
    .pie-area{display:grid;grid-template-columns:1fr;gap:12px;padding:20px;align-items:center}
    .face-wrap{position:relative;max-width:560px;margin:0 auto;border-radius:16px;overflow:visible}
    .face-img{width:100%;height:auto;border-radius:12px;display:block;transform-origin:center center;transition:transform .3s}
    .pie-button{background:linear-gradient(180deg,#ffd65e,#ffb703);border:none;padding:12px;border-radius:12px;font-weight:800;cursor:pointer}
    .pie-img{position:absolute;width:140px;height:140px;pointer-events:none;border-radius:20px;transform-origin:center center;will-change:transform,opacity}

    /* splat drip (CSS pseudo, we will create element) */
    .shake{animation:shake .28s ease-in-out}
    @keyframes shake{
      0%{transform:translateX(0)}
      25%{transform:translateX(-8px)}
      50%{transform:translateX(8px)}
      75%{transform:translateX(-6px)}
      100%{transform:translateX(0)}
    }

    /* -------------------- LETTER interaction -------------------- */
    .letter-area{padding:30px 18px;display:flex;flex-direction:column;gap:12px;align-items:center}
    #letterHeadline{font-size:1.4rem;color:var(--rose-deep);cursor:pointer;display:inline-block;padding:8px 14px;border-radius:999px;background:linear-gradient(180deg,#fff,#fffaf6);box-shadow:var(--soft-shadow);transition:transform .28s,box-shadow .28s;animation:headlinePulse 3s infinite}
    @keyframes headlinePulse{
      0%{transform:scale(1);box-shadow:0 10px 40px rgba(230,60,100,0)}
      50%{transform:scale(1.02);box-shadow:0 18px 60px rgba(230,60,100,.05)}
      100%{transform:scale(1);box-shadow:0 10px 40px rgba(230,60,100,0)}
    }

    .envelope-viewport{height:320px;width:360px;position:relative;perspective:1200px;margin-top:8px}
    .envelope{
      width:100%;height:100%;position:absolute;left:0;top:0;transform-style:preserve-3d;transition:transform 900ms cubic-bezier(.2,.9,.2,1);cursor:pointer;
      display:flex;align-items:center;justify-content:center;
    }
    .envelope .face{
      position:absolute;inset:0;border-radius:12px;background:linear-gradient(180deg,#ffdfe9,#fff);box-shadow:0 10px 40px rgba(0,0,0,.14);display:flex;align-items:center;justify-content:center;font-weight:800;color:var(--rose-deep);font-size:1.2rem;backface-visibility:hidden;
    }
    .envelope .back{
      position:absolute;inset:0;border-radius:12px;background:linear-gradient(180deg,#fff6fa,#fff);box-shadow:0 4px 16px rgba(0,0,0,.08);transform:rotateY(180deg);backface-visibility:hidden;padding:18px;font-size:.95rem;color:#333;overflow:hidden;
    }
    .envelope.enter{animation:bounceIn .7s both}
    @keyframes bounceIn{0%{transform:translateY(-40vh) scale(.6) rotate(-6deg)}60%{transform:translateY(10px) scale(1.02)}100%{transform:translateY(0) scale(1) rotate(0)}}
    .envelope.flipped{transform:rotateY(180deg) translateZ(0)}

    .letter-sheet{
      position:absolute;width:86%;left:7%;top:62%;transform:translateY(18px);background:var(--parchment);
      padding:18px 16px 22px;border-radius:10px;box-shadow:0 18px 40px rgba(0,0,0,.12);opacity:0;
      transition:transform .6s cubic-bezier(.2,.9,.2,1),opacity .6s;
      background-image: radial-gradient(ellipse at top left, rgba(230,60,100,0.05), transparent 40%),
                        linear-gradient(transparent 24px, rgba(0,0,0,.04) 25px, transparent 26px);
      background-size: 100% 100%, 100% 28px;
      font-family: "Crimson Pro", Georgia, serif;
    }
    .letter-sheet.visible{opacity:1;transform:translateY(-120px)}
    .letter-title{font-family:"Great Vibes", cursive; font-size:1.4rem; color:#a8334a; text-align:center; margin-bottom:6px}
    .letter-meta{display:flex; align-items:center; justify-content:space-between; margin:4px 0 10px 0; font-size:.85rem; color:#a0777a}
    .wax-seal{
      position:absolute; right:-8px; bottom:-10px; width:64px; height:64px; border-radius:999px; background:radial-gradient(circle at 30% 30%, #d63b57, var(--seal));
      box-shadow:0 6px 16px rgba(0,0,0,.25), inset 0 4px 10px rgba(0,0,0,.25);
      display:flex; align-items:center; justify-content:center; color:#fff; font-size:24px; transform:rotate(-8deg)
    }
    .stamp{
      position:absolute; top:6px; right:8px; border:2px dashed rgba(166,43,106,.35); padding:6px 10px; border-radius:6px; font-size:.8rem; color:#a62b6a; transform:rotate(6deg); background:#fff8fc
    }
    .letter-content{max-height:270px; overflow:auto; padding-right:6px}
    .letter-content ul{margin:8px 0 0 18px}
    .letter-content li{margin:6px 0}
    .signature{margin-top:8px; font-family:"Great Vibes", cursive; font-size:1.3rem; color:#a8334a; text-align:right}

    .letter-text-line{opacity:0;transform:translateY(6px);transition:opacity .45s ease,transform .45s ease}

    /* editor & save */
    .editor-ui{display:flex;flex-direction:column;gap:8px;margin-top:8px;width:88%}
    textarea.editor{width:100%;min-height:180px;padding:12px;border-radius:8px;border:1px solid #ffdfe9;font-family:Georgia,serif;font-size:1rem}
    .letter-tabs{display:flex; gap:6px; justify-content:center; margin-top:8px}
    .letter-tab{padding:8px 12px; border-radius:999px; background:linear-gradient(180deg,#fff,#fffaf6); border:1px solid #ffdfe9; cursor:pointer; box-shadow:var(--soft-shadow); font-weight:700; color:#a62b6a}
    .letter-tab[aria-selected="true"]{background:linear-gradient(180deg,#ffe6ef,#fff); outline:2px solid #ffc2d6}
    .letter-cta{display:flex; gap:8px; justify-content:center; margin-top:8px}

    /* responsive */
    @media (max-width:880px){
      .donkey-img{height:44vh}
      .screen .media-frame{height:32vh}
      .envelope-viewport{width:92%;height:260px}
      .letter-content{max-height:220px}
    }

    /* prefers reduced motion */
    @media (prefers-reduced-motion: reduce){
      .donkey-img,.dil-player,.screen .media-frame,.letter-sheet{transition:none!important;animation:none!important}
    }
  </style>
</head>
<body>

  <div class="sparkles" id="sparkles" aria-hidden="true"></div>

  <header>
    <div class="brand container">
      <div>
        <h1 id="brandTitle">From the Stupidest Donkey Alive‚Ä¶</h1>
        <div class="subtitle muted">A small interactive page ‚Äî open letters when you're ready.</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn" id="editToggle" aria-pressed="false">‚úèÔ∏è Edit: Off</button>
        <button class="btn" id="resetAll">‚Ü∫ Reset</button>
      </div>
    </div>
  </header>

  <!-- DONKEY -->
  <main class="container">
    <section class="block donkey" id="donkeySection" aria-labelledby="donkeyTitle">
      <div class="section-title"><h2 id="donkeyTitle">üê¥ Donkey Love</h2></div>
      <div class="donkey-card">
        <img id="donkeyImg" class="donkey-img" src="donkeyLove.jpg" alt="Donkey photo">
        <div class="donkey-heart">üíò</div>
      </div>
    </section>

    <!-- DIL -->
    <section class="block dil-wrap" id="dilSection" aria-labelledby="dilTitle">
      <div class="section-title"><h2 id="dilTitle">üíì Dil Ka Jo Haal Hai</h2></div>
      <div class="heart-frame" role="region" aria-label="dil video">
        <div class="heart-bg"></div>
        <div class="dil-player" id="dilPlayer">
          <div class="heart-pulse" aria-hidden="true"></div>
          <video id="dilVideo" playsinline preload="metadata" controls>
            <source src="DilKaHaal.mp4" type="video/mp4">
            Your browser doesn't support this video.
          </video>
        </div>
        <!-- floating musical notes (JS will spawn) -->
      </div>
    </section>

    <!-- THEATER -->
    <section class="block theater-wrap" id="theaterSection" aria-labelledby="theaterTitle">
      <div class="section-title"><h2 id="theaterTitle">üé¨ Perfect Together ‚Äî The Short Film</h2></div>
      <div class="curtains" aria-hidden="true" style="height:0;">
        <div class="curtain left" id="curtainLeft"></div>
        <div class="curtain right" id="curtainRight"></div>
      </div>
      <div class="screen" id="screen">
        <!-- Swapped local MP4 for Drive embed (keeps the same reveal animation) -->
        <iframe
          id="perfectFrame"
          class="media-frame"
          src="https://drive.google.com/file/d/1EwD4pr9sEOEdrvRQwVl-eoyAsDWJH0fg/preview"
          allow="autoplay; fullscreen"
          allowfullscreen
          title="Perfect Together (Drive Embed)"></iframe>
      </div>
    </section>

    <!-- PIE -->
    <section class="block pie-area" id="pieSection" aria-labelledby="pieTitle">
      <div class="section-title"><h2 id="pieTitle">ü•ß Pie My Face (for fun)</h2></div>
      <div class="face-wrap">
        <img id="faceImg" class="face-img" src="donkeyLove.jpg" alt="Face image for pie">
        <!-- pies will be created dynamically -->
      </div>
      <div style="display:flex;gap:10px;justify-content:center;margin-top:10px">
        <button class="pie-button" id="pieBtn">Throw Pie!</button>
        <button class="pie-button" id="rapidPie">Rapid Pies</button>
      </div>
    </section>

    <!-- LETTERS -->
    <section class="block letter-area" id="lettersSection" aria-labelledby="lettersTitle">
      <div class="section-title"><h2 id="lettersTitle">üíå The 3 Letters</h2></div>

      <div class="center">
        <div id="letterHeadline" role="button" tabindex="0" aria-pressed="false">Click to reveal the envelope</div>

        <div class="letter-tabs" id="letterTabs" style="display:none" role="tablist" aria-label="Choose a letter">
          <button class="letter-tab" role="tab" id="tab-1" aria-selected="true" data-index="0">Letter 1</button>
          <button class="letter-tab" role="tab" id="tab-2" aria-selected="false" data-index="1">Letter 2</button>
          <button class="letter-tab" role="tab" id="tab-3" aria-selected="false" data-index="2">Letter 3</button>
        </div>

        <div class="envelope-viewport" id="envelopeViewport" aria-hidden="true" style="display:none">
          <div class="envelope enter" id="envelope" role="button" tabindex="0" aria-label="Envelope ‚Äî click to open">
            <div class="face">üì© Open Me</div>
            <div class="back">Envelope back</div>
            <!-- letter sheet -->
            <div class="letter-sheet" id="letterSheet" aria-hidden="true">
              <div class="stamp">Love Mail</div>
              <div class="letter-meta"><span id="letterCount">Letter 1 of 3</span><span>for Ishani</span></div>
              <div class="letter-title" id="letterTitle">To the Moon and Back</div>
              <div class="letter-content" id="letterContent"><!-- populated by JS --></div>
              <div class="signature" id="letterSignature">‚Äî Yours, always</div>
              <div class="wax-seal" aria-hidden="true">‚ù§</div>
            </div>
          </div>
        </div>

        <div class="letter-cta" id="letterCta" style="display:none">
          <button class="btn" id="prevLetter">‚¨ÖÔ∏è Previous</button>
          <button class="btn" id="nextLetter">Next ‚û°Ô∏è</button>
        </div>

        <div class="editor-ui" id="editorUI" style="display:none">
          <label class="muted">Edit selected letter (saved in your browser only):</label>
          <textarea id="letterEditor" class="editor" placeholder="Edit the visible letter here and click Save."></textarea>
          <div style="display:flex;gap:8px;justify-content:center">
            <button class="btn" id="saveLetter">Save</button>
            <button class="btn" id="resetLetter">Reset current</button>
          </div>
        </div>

      </div>
    </section>

  </main>

  <footer style="padding:30px 12px;text-align:center;opacity:.85">
    Made with too much love (and tiny donkey energy) ü´è
  </footer>

  <script>
    /* -------------------- helpful utils -------------------- */
    const $ = (sel,root=document)=>root.querySelector(sel);
    const $$ = (sel,root=document)=>[...root.querySelectorAll(sel)];
    const random = (min,max)=> Math.random()*(max-min)+min;

    /* -------------------- sparkles background -------------------- */
    (function spawnSparkles(){
      const root = $('#sparkles');
      const count = 14;
      for(let i=0;i<count;i++){
        const el = document.createElement('div');
        el.className='spark';
        const left = Math.random()*100;
        const top = Math.random()*100;
        el.style.left = left + '%';
        el.style.top = top + '%';
        el.style.width = (6 + Math.random()*12)+'px';
        el.style.height = el.style.width;
        el.style.opacity = (0.05 + Math.random()*0.25);
        root.appendChild(el);
        // subtle float
        (function anim(e){
          const dx = (Math.random()-0.5)*20;
          const dy = (Math.random()*18)+6;
          e.animate([
            { transform: `translateY(0) translateX(0)`, opacity: e.style.opacity },
            { transform: `translateY(-${dy}px) translateX(${dx}px)`, opacity: 0.02 }
          ], { duration: 4000 + Math.random()*4000, iterations: Infinity, direction: 'alternate', easing: 'ease-in-out' });
        })(el);
      }
    })();

    /* -------------------- donkey photo load animation & hearts on click -------------------- */
    const donkeyImg = $('#donkeyImg');
    donkeyImg.addEventListener('load', ()=>{ donkeyImg.classList.add('loaded'); });
    // clicking anywhere spawns small hearts (except on buttons or editors)
    document.addEventListener('click', (e)=>{
      if(e.target.closest('.btn') || e.target.closest('textarea') || e.target.closest('.editor')) return;
      spawnHeartAt(e.clientX, e.clientY);
    });
    function spawnHeartAt(x,y){
      const h = document.createElement('div');
      h.textContent = 'üíó';
      h.style.position='fixed';
      h.style.left = (x - 12)+'px';
      h.style.top = (y - 12)+'px';
      h.style.fontSize = (12 + Math.random()*18)+'px';
      h.style.pointerEvents='none';
      h.style.opacity=1;
      h.style.transform = `translateY(0) rotate(${Math.random()*40-20}deg)`;
      h.style.transition = 'transform 1200ms linear, opacity 1200ms linear';
      document.body.appendChild(h);
      setTimeout(()=> h.style.transform = `translateY(-140px) rotate(${Math.random()*360}deg) scale(${1+Math.random()})`, 30);
      setTimeout(()=> h.style.opacity = '0', 900);
      setTimeout(()=> h.remove(), 1400);
    }

    /* -------------------- DIL: show player with animation + spawn notes on play -------------------- */
    const dilPlayer = $('#dilPlayer');
    const dilVideo = $('#dilVideo');
    // reveal when scrolled into view
    (function observeDil(){
      const obs = new IntersectionObserver(entries=>{
        entries.forEach(en=>{
          if(en.isIntersecting) dilPlayer.classList.add('visible');
        });
      }, {threshold:0.28});
      obs.observe($('#dilSection'));
    })();

    // spawn little musical notes when playing
    dilVideo.addEventListener('play', ()=>{ spawnMusicNotes(8); });
    function spawnMusicNotes(n){
      const wrap = $('#dilSection');
      for(let i=0;i<n;i++){
        setTimeout(()=>{
          const note = document.createElement('div');
          note.className='music-note';
          note.innerHTML = '‚ô™';
          note.style.left = (20 + Math.random()*60) + '%';
          note.style.top = (60 + Math.random()*10) + '%';
          note.style.fontSize = (18 + Math.random()*26) + 'px';
          note.style.transform = `translateY(20px) rotate(${Math.random()*30-15}deg)`;
          note.style.transition = 'transform 1800ms cubic-bezier(.2,.9,.2,1), opacity 1400ms';
          wrap.appendChild(note);
          requestAnimationFrame(()=> note.style.transform = `translateY(-220px) rotate(${Math.random()*360}deg)`, note.style.opacity='0');
          setTimeout(()=> note.remove(), 1800);
        }, i*160);
      }
    }

    /* -------------------- THEATER: curtains open on view + screen reveal -------------------- */
    const curtainL = $('#curtainLeft'), curtainR = $('#curtainRight'), screen = $('#screen');
    (function observeTheater(){
      const obs = new IntersectionObserver(entries=>{
        entries.forEach(en=>{
          if(en.isIntersecting){
            curtainL.classList.add('open');
            curtainR.classList.add('open');
            setTimeout(()=> screen.classList.add('visible'), 750);
          }
        });
      }, {threshold:0.24});
      obs.observe($('#theaterSection'));
    })();

    /* -------------------- PIE fun: create flying pie, spin, splat and drip -------------------- */
    const pieBtn = $('#pieBtn'), rapidPie = $('#rapidPie'), faceImg = $('#faceImg');
    let rapidInt = null;
    pieBtn.addEventListener('click', ()=> throwPieAtFace());
    rapidPie.addEventListener('mousedown', ()=> { if(rapidInt) return; rapidInt = setInterval(throwPieAtFace, 240); });
    document.addEventListener('mouseup', ()=>{ if(rapidInt){ clearInterval(rapidInt); rapidInt = null; } });
    function throwPieAtFace(){
      const rect = faceImg.getBoundingClientRect();
      const centerX = rect.left + rect.width/2 + window.scrollX;
      const centerY = rect.top + rect.height/2 + window.scrollY;
      createPie(centerX + (Math.random()*80-40), centerY - 60);
      // small camera shake
      const sec = $('#pieSection');
      sec.classList.add('shake');
      setTimeout(()=> sec.classList.remove('shake'), 320);
    }
    function createPie(pageX,pageY){
      const p = document.createElement('img');
      p.src = 'pie.png'; // add pie.png to repo
      p.alt = 'pie';
      p.className = 'pie-img';
      p.style.left = (pageX - 70) + 'px';
      p.style.top = (pageY - 70) + 'px';
      p.style.opacity = '0';
      p.style.transform = `translateY(-200px) rotate(${Math.random()*40-20}deg) scale(.6)`;
      document.body.appendChild(p);
      // drop with spin
      requestAnimationFrame(()=> {
        p.style.transition = 'transform 420ms cubic-bezier(.2,.9,.2,1), opacity 240ms'; p.style.opacity='1';
        p.style.transform = `translateY(0px) rotate(${360 + Math.random()*360}deg) scale(1)`;
      });
      // splat: flatten and fade; create cream drip
      setTimeout(()=>{
        p.style.transition = 'transform 300ms ease-out, opacity 400ms linear';
        p.style.transform = `translateY(-6px) rotate(15deg) scale(.88)`;
        // create drip
        const drip = document.createElement('div');
        drip.style.position='absolute';
        drip.style.left = (parseFloat(p.style.left) + 44) + 'px';
        drip.style.top = (parseFloat(p.style.top) + 74) + 'px';
        drip.style.width='12px'; drip.style.height='28px'; drip.style.borderRadius='8px';
        drip.style.background='linear-gradient(180deg,#fff,#fff8)';
        drip.style.opacity='0.98';
        drip.style.transform='translateY(-2px)';
        drip.style.transition='transform 1400ms linear, opacity 900ms';
        document.body.appendChild(drip);
        setTimeout(()=> { drip.style.transform='translateY(36px)'; drip.style.opacity='0.6'; setTimeout(()=> drip.remove(), 1500); }, 160);
      }, 460);
      setTimeout(()=> { p.style.opacity='0'; setTimeout(()=> p.remove(), 420); }, 1400);
    }

    /* -------------------- LETTERS: content (3 letters exactly as provided) -------------------- */
    const LETTERS = [
      {
        title: "To the Moon and Back",
        signature: "‚Äî Yours, always",
        html: `
          <div class="letter-text-line">
          I love you to the moon and back Baby there is no limit to how much I love you and sometimes words feel too small to explain it. But still I want you to know that my love for you is endless. When I say I love you to the moon and back it‚Äôs not just a line it‚Äôs the truth of my heart. I love you everthing about you you're smile, you're eyes, you're lips, you're voice I love everything that you do I love you I love you so much that even if I tried to count it would never end. From the moment I wake up till the time I close my eyes at night tum mere dil mein ho. Every heartbeat is a reminder that I‚Äôm made to love you. Baby no distance no fight no sadness can ever change how much I love you. My love for you grows every single day and I know it will keep growing forever. So when I say I love you to the moon and back it means that even if the world ends my love for you will still remain. Ishani You asked me once why I chose you and my answer is simple because nothing has ever felt more real you are a place for my heart to rest, the hand I reach for in dark and light. Loving you wasn't a decision, it was something I realized I had already done.I love you and I'll never in this life love anyone else ever again you're going to be my last love and I'll always love you. I love you to the moon and back and much much more baby to infinity and beyond............
          </div>
        `
      },
      {
        title: "Some of the Reasons I Love You",
        signature: "‚Äî Forever yours",
        html: `
          <ul>
            <li class="letter-text-line">I love the way tum mera naam pyaar se bolte ho.</li>
            <li class="letter-text-line">I love jab tum bina wajah mujhe irritate karte ho bas meri reaction dekhne ke liye.</li>
            <li class="letter-text-line">I love the way tum gussa karte ho aur phir khud hi pighal jaate ho.</li>
            <li class="letter-text-line">I love ki tum mere har stupid joke pe bhi hasta dete ho.</li>
            <li class="letter-text-line">I love how tum mujhe samajh jaate ho bina main kuch bolun.</li>
            <li class="letter-text-line">I love ki tum meri silence ko bhi feel kar lete ho.</li>
            <li class="letter-text-line">I love jab tum randomly bol dete ho ‚ÄúI love you‚Äù bina reason ke.</li>
            <li class="letter-text-line">I love ki tum raat ko sirf meri awaaz sunane ke liye call karte ho.</li>
            <li class="letter-text-line">I love the way tum mujhe apna best friend aur lover dono banake rakhte ho.</li>
            <li class="letter-text-line">I love ki tum kabhi kabhi mummy ki tarah mujhe daant dete ho.</li>
            <li class="letter-text-line">I love jab tum meri care karte ho jaise main sabse special hoon.</li>
            <li class="letter-text-line">I love ki tum din mein 100 baar poochte ho ‚Äúkhana khaya na.‚Äù</li>
            <li class="letter-text-line">I love ki tum mujhe hamesha priority dete ho.</li>
            <li class="letter-text-line">I love the way tum mujhe motivate karte ho jab main give up karne lagta hoon.</li>
            <li class="letter-text-line">I love ki tum apne sapne mere saath share karte ho.</li>
            <li class="letter-text-line">I love ki tum apne har chhoti badi baat mujhe batana pasand karte ho.</li>
            <li class="letter-text-line">I love jab tum khud ke jokes pe khud hi haste ho.</li>
            <li class="letter-text-line">I love the way tum gussa hone ke baad chup ho jaate ho aur mujhe tension dete ho.</li>
            <li class="letter-text-line">I love jab tum bolte ho ‚Äúmujhe abhi chocolate chahiye.‚Äù</li>
            <li class="letter-text-line">I love ki tum mujhe apni diary ki tarah treat karte ho.</li>
            <li class="letter-text-line">I love jab tum ignore karne ka drama karte ho.</li>
            <li class="letter-text-line">I love the way tum possessive hoke bolte ho ‚Äútum sirf mere ho.‚Äù</li>
            <li class="letter-text-line">I love jab tum bolte ho ki ‚Äúmain tumhare bina reh nahi sakti.‚Äù</li>
            <li class="letter-text-line">I love jab tum mujhe tease karte ho hasi hasi mein.</li>
            <li class="letter-text-line">I love ki tum mujhe hamesha confident feel karate ho.</li>
            <li class="letter-text-line">I love jab tum apne future ke plans mein mujhe include karte ho.</li>
            <li class="letter-text-line">I love the way tum mujhe hug karte ho jaise main poori duniya hoon tumhari.</li>
            <li class="letter-text-line">I love ki tum mere bina ek din bhi reh nahi paate aur turant miss karte ho.</li>
            <li class="letter-text-line">I love the way tum ‚Äúbaby‚Äù bolte ho aur mera din ban jaata hai.</li>
            <li class="letter-text-line">I love ki tum mujhe kabhi baccha treat karte ho aur kabhi ek strong banda.</li>
            <li class="letter-text-line">I love jab tum apna gussa sirf mujhpe nikalte ho aur dusron pe nahi.</li>
            <li class="letter-text-line">I love ki tum mere messages ka reply fast dete ho chahe busy ho.</li>
            <li class="letter-text-line">I love jab tum bolte ho ‚Äútum mere ho aur bas mere hi rahoge.‚Äù</li>
            <li class="letter-text-line">I love ki tum mujhe bina try kiye special feel karate ho.</li>
            <li class="letter-text-line">I love jab tum attitude dikhate ho bas mujhe tang karne ke liye.</li>
            <li class="letter-text-line">I love jab tum chhoti si compliment dete ho aur main blush karne lagta hoon.</li>
            <li class="letter-text-line">I love jab tum randomly bol dete ho ki ‚Äúmujhe tumhari yaad aa rahi hai.‚Äù</li>
            <li class="letter-text-line">I love ki tum mujhe apne phone aur secrets trust karke dete ho.</li>
            <li class="letter-text-line">I love the way tum mujhe apna safe space banate ho.</li>
            <li class="letter-text-line">I love jab tum apni selfies bhejte ho sirf meri reaction ke liye.</li>
            <li class="letter-text-line">I love jab tum mujhe ‚Äúpagal‚Äù bolke hasi nikalte ho.</li>
            <li class="letter-text-line">I love ki tum mujhe apna sabse close person mante ho.</li>
            <li class="letter-text-line">I love the way tum mujhe har situation mein support karte ho.</li>
            <li class="letter-text-line">I love jab tum apni problems mujhe batate ho bina jhijhak.</li>
            <li class="letter-text-line">I love ki tum mujhe hamesha believe karte ho.</li>
            <li class="letter-text-line">I love jab tum chhoti si jealousy dikhate ho.</li>
            <li class="letter-text-line">I love jab tum mera mood instantly change kar dete ho.</li>
            <li class="letter-text-line">I love jab tum mujhse apna favourite song share karte ho.</li>
            <li class="letter-text-line">I love ki tum meri har baat seriously lete ho.</li>
            <li class="letter-text-line">I love the way tum mere liye effort karte ho.</li>
            <li class="letter-text-line">I love jab tum mujhe apni shopping choices mein involve karte ho.</li>
            <li class="letter-text-line">I love jab tum mujhe bolte ho ki main tumhari jaan hoon.</li>
            <li class="letter-text-line">I love ki tum hamesha meri izzat karte ho.</li>
            <li class="letter-text-line">I love jab tum mujhe apni chhoti chhoti khushiyan share karte ho.</li>
            <li class="letter-text-line">I love jab tum mujhe bina wajah miss karte ho.</li>
            <li class="letter-text-line">I love ki tum mujhe har galti ke baad maaf kar dete ho.</li>
            <li class="letter-text-line">I love jab tum mujhe apna lucky charm mante ho.</li>
            <li class="letter-text-line">I love ki tum hamesha mujhe better banne ke liye push karte ho.</li>
            <li class="letter-text-line">I love jab tum mujhe chhoti chhoti surprises dete ho.</li>
            <li class="letter-text-line">I love jab tum mujhe apni life ka best part bolte ho.</li>
            <li class="letter-text-line">I love ki tum meri care karte ho jaise main tumhara baby hoon.</li>
            <li class="letter-text-line">I love jab tum mujhe bina reason hugs dete ho.</li>
            <li class="letter-text-line">I love jab tum mere liye cute sa gussa karte ho.</li>
            <li class="letter-text-line">I love ki tum mujhe apna first priority mante ho.</li>
            <li class="letter-text-line">I love jab tum mere saath apni funny childhood stories share karte ho.</li>
            <li class="letter-text-line">I love jab tum mujhe respect ke saath pyaar karte ho.</li>
            <li class="letter-text-line">I love ki tum meri kamiya bhi accept karte ho.</li>
            <li class="letter-text-line">I love jab tum mujhe ‚Äúmeri jaan‚Äù bolte ho.</li>
            <li class="letter-text-line">I love jab tum mujhe inspire karte ho.</li>
            <li class="letter-text-line">I love ki tum hamesha mere side pe khade hote ho no matter what.</li>
            <li class="letter-text-line">I love jab tum mujhe suljhate ho jab main confuse hota hoon.</li>
            <li class="letter-text-line">I love ki tum mujhe kabhi akela feel nahi karne dete.</li>
            <li class="letter-text-line">I love jab tum mujhe khudse zyada important mante ho.</li>
            <li class="letter-text-line">I love the way tum mujhe blush karva dete ho.</li>
            <li class="letter-text-line">I love ki tum mere saath chhoti chhoti cheezein celebrate karte ho.</li>
            <li class="letter-text-line">I love jab tum mujhe future ke dreams batate ho jisme main hota hoon.</li>
            <li class="letter-text-line">I love jab tum mujhe ‚Äútum meri ho‚Äù yaad dilate ho.</li>
            <li class="letter-text-line">I love ki tum mujhe kabhi judge nahi karte.</li>
            <li class="letter-text-line">I love jab tum mujhe hug karke saari problems bhula dete ho.</li>
            <li class="letter-text-line">I love ki tum mere saath childish ban jaate ho.</li>
            <li class="letter-text-line">I love jab tum mujhe apni diary ke jaise treat karte ho.</li>
            <li class="letter-text-line">I love ki tum mujhe hamesha apna best dikhana chahte ho.</li>
            <li class="letter-text-line">I love jab tum mujhe phone karke bas chup rehte ho.</li>
            <li class="letter-text-line">I love ki tum meri life mein hamesha honesty leke aaye ho.</li>
            <li class="letter-text-line">I love jab tum mujhe pyaar se tang karte ho.</li>
            <li class="letter-text-line">I love ki tum meri aankhon mein dekh kar sab samajh jaate ho.</li>
            <li class="letter-text-line">I love jab tum meri family ke saath bhi pyar se behave karte ho.</li>
            <li class="letter-text-line">I love ki tum mujhe har din naya pyaar feel karate ho.</li>
            <li class="letter-text-line">I love jab tum mujhe apne liye perfect mante ho.</li>
            <li class="letter-text-line">I love ki tum meri duniya ho.</li>
            <li class="letter-text-line">I love jab tum mujhe apna forever bolte ho.</li>
            <li class="letter-text-line">I love ki tum mere har dukh ko apna bana lete ho.</li>
            <li class="letter-text-line">I love jab tum mujhe apne favourite person bolte ho.</li>
            <li class="letter-text-line">I love ki tum meri life ka sabse acha decision ho.</li>
            <li class="letter-text-line">I love jab tum mujhe raat ko goodnight wish karte ho.</li>
            <li class="letter-text-line">I love ki tum meri subah ka reason ho smile karne ka.</li>
            <li class="letter-text-line">I love jab tum mujhe apna soulmate mante ho.</li>
            <li class="letter-text-line">I love ki tum meri har heartbeat mein ho.</li>
            <li class="letter-text-line">I love jab tum mujhe khud pe proud feel karwate ho.</li>
            <li class="letter-text-line">I love you because tum meri zindagi ka sabse beautiful gift ho.</li>
          </ul>
        `
      },
      {
        title: "I‚Äôm Sorry Baby",
        signature: "‚Äî I‚Äôll always try harder",
        html: `
          <div class="letter-text-line">
          I just want to say I‚Äôm really really sorry. I know I make mistakes and i'm literally the stupidest person in this world currently but trust me I never want to hurt you. Tum meri sabse special cheez ho hai aur main hamesha bas yahi chahta hoon ki tum khush raho whatever it may take I promise I‚Äôll be better. I‚Äôll learn from every mistake and make sure I never repeat it again. Main kuch bhi karunga bas taaki tum smile karo I love you're smile and I can do whatevr it takes to see that. I wish Ishani that you could see yourself from my eyes honestly you'd fall head over heels for yourself Ishani ik I fall short to show you how much you mean to me and I'm really sorry for that ik you feel like you have to ask things from me and then only it gets done and that i don't do anything from my end Ishani I'm really really sorry for that there's honestly no explanation for my wrongdoing except that i'm the world's biggest idiot keeping the most beautiful girl n this wole wide world sad and Ishani ik i just say it but i will spend the rest of my time in this world with the only thing i treasure and that's you and I'll make sure that you know that You deserve all the love and happiness in the world and I‚Äôll do everything I can to give that to you. Please forgive me baby. I love you endlessly and I‚Äôll always keep trying to be the best for you.
          </div>
        `
      }
    ];

    /* -------------------- LETTER interactions & editor -------------------- */
    const letterHeadline = $('#letterHeadline');
    const envelopeViewport = $('#envelopeViewport');
    const envelope = $('#envelope');
    const letterSheet = $('#letterSheet');
    const letterContent = $('#letterContent');
    const letterTitle = $('#letterTitle');
    const letterCount = $('#letterCount');
    const letterSignature = $('#letterSignature');
    const editorUI = $('#editorUI');
    const letterEditor = $('#letterEditor');
    const saveLetterBtn = $('#saveLetter');
    const resetLetterBtn = $('#resetLetter');
    const editToggle = $('#editToggle');
    const resetAllBtn = $('#resetAll');
    const letterTabs = $('#letterTabs');
    const prevLetterBtn = $('#prevLetter');
    const nextLetterBtn = $('#nextLetter');
    const letterCta = $('#letterCta');

    const STORAGE_KEYS = ['forgive_letter_1','forgive_letter_2','forgive_letter_3'];
    let currentLetter = 0; // 0..2
    let flipped = false;

    // Load any saved edits
    LETTERS.forEach((L, idx)=>{
      const saved = localStorage.getItem(STORAGE_KEYS[idx]);
      if(saved && saved.trim()){
        L.html = saved; // keep user's edited HTML
      }
    });

    function setTabActive(i){
      $$('.letter-tab').forEach((b,idx)=>{
        b.setAttribute('aria-selected', String(idx===i));
      });
    }

    function renderLetter(i){
      const L = LETTERS[i];
      letterTitle.textContent = L.title;
      letterSignature.textContent = L.signature;
      letterCount.textContent = `Letter ${i+1} of ${LETTERS.length}`;
      letterContent.innerHTML = L.html;

      // sequential reveal animation for each .letter-text-line or each child
      const nodes = $$('.letter-text-line', letterContent);
      if(nodes.length){
        nodes.forEach((n,idx)=> { n.style.opacity='0'; n.style.transform='translateY(6px)'; n.style.transitionDelay = (idx*90)+'ms'; });
        setTimeout(()=> nodes.forEach(n=>{ n.style.opacity='1'; n.style.transform='translateY(0)'; }), 80);
      } else {
        // If no .letter-text-line present (e.g., plain HTML), fade container
        letterContent.style.opacity='0'; letterContent.style.transition='opacity 500ms ease';
        requestAnimationFrame(()=> letterContent.style.opacity='1');
      }

      // put current HTML into editor for optional editing
      letterEditor.value = L.html;
      setTabActive(i);
    }

    function showEnvelopeAndTabs(){
      envelopeViewport.style.display = 'block';
      letterTabs.style.display = 'flex';
      letterCta.style.display = 'flex';
      setTimeout(()=> envelope.classList.add('enter'), 40);
      envelope.setAttribute('tabindex', '0');
      envelopeViewport.setAttribute('aria-hidden', 'false');
      renderLetter(currentLetter);
    }

    // show envelope when headline clicked
    letterHeadline.addEventListener('click', showEnvelopeAndTabs);
    letterHeadline.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); showEnvelopeAndTabs(); } });

    // tabs switching
    letterTabs.addEventListener('click', (e)=>{
      const btn = e.target.closest('.letter-tab');
      if(!btn) return;
      currentLetter = Number(btn.dataset.index);
      renderLetter(currentLetter);
      // keep sheet visible state if already flipped
      if(flipped){
        // re-run line reveals
        const nodes = $$('.letter-text-line', letterContent);
        nodes.forEach((n,idx)=> setTimeout(()=> { n.style.opacity='1'; n.style.transform='translateY(0)'; }, 130 + idx*120));
      }
    });

    prevLetterBtn.addEventListener('click', ()=>{
      currentLetter = (currentLetter + LETTERS.length - 1) % LETTERS.length;
      renderLetter(currentLetter);
    });
    nextLetterBtn.addEventListener('click', ()=>{
      currentLetter = (currentLetter + 1) % LETTERS.length;
      renderLetter(currentLetter);
    });

    // envelope flip to reveal letter
    function flipEnvelope(){
      flipped = !flipped;
      if(flipped){
        envelope.classList.add('flipped');
        setTimeout(()=> {
          letterSheet.classList.add('visible');
          const nodes = $$('.letter-text-line', letterSheet);
          nodes.forEach((n,idx)=>{ setTimeout(()=>{ n.style.opacity='1'; n.style.transform='translateY(0)'; }, 130 + idx*140); });
        }, 420);
      } else {
        letterSheet.classList.remove('visible');
        $$('.letter-text-line', letterSheet).forEach(n=>{ n.style.opacity='0'; n.style.transform='translateY(6px)'; });
        setTimeout(()=> envelope.classList.remove('flipped'), 200);
      }
    }
    envelope.addEventListener('click', flipEnvelope);
    envelope.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); flipEnvelope(); } });

    // save & reset for current letter
    saveLetterBtn.addEventListener('click', ()=>{
      const val = letterEditor.value || '';
      localStorage.setItem(STORAGE_KEYS[currentLetter], val);
      LETTERS[currentLetter].html = val;
      renderLetter(currentLetter);
      alert('Saved in your browser ‚úîÔ∏è');
    });
    resetLetterBtn.addEventListener('click', ()=>{
      if(confirm('Reset just this letter to original (clear saved content)?')){
        localStorage.removeItem(STORAGE_KEYS[currentLetter]);
        // (Rebuild from hardcoded originals by reloading page or reassigning from initial constants.)
        // For simplicity, reload:
        location.reload();
      }
    });

    // edit toggle (global)
    editToggle.addEventListener('click', ()=>{
      const on = editToggle.getAttribute('aria-pressed') === 'true';
      editToggle.setAttribute('aria-pressed', String(!on));
      editToggle.textContent = `‚úèÔ∏è Edit: ${!on ? 'On' : 'Off'}`;
      editorUI.style.display = !on ? 'block' : 'none';
    });

    // reset all (clears storage + resets UI)
    resetAllBtn.addEventListener('click', ()=>{
      if(confirm('Reset everything saved for this page? This will clear the saved letters.')) {
        STORAGE_KEYS.forEach(k=> localStorage.removeItem(k));
        location.reload();
      }
    });

    /* -------------------- keyboard shortcut: L reveals letter typewriter style (nice touch) -------------------- */
    document.addEventListener('keydown', (e)=>{
      if(e.key.toLowerCase() === 'l'){
        if(letterHeadline) letterHeadline.click();
        if(!flipped) setTimeout(()=> flipEnvelope(), 600);
      }
    });

    /* -------------------- prefetch images & mark donkey loaded if cached -------------------- */
    if(donkeyImg.complete) donkeyImg.classList.add('loaded');

    /* -------------------- accessibility & cleanup -------------------- */
    window.addEventListener('beforeunload', ()=> {
      const vids = $$('video');
      vids.forEach(v=>{ try{ v.pause(); }catch(e){} });
    });

    /* -------------------- final: gentle entrance animations on load -------------------- */
    window.addEventListener('load', ()=>{
      setTimeout(()=> {
        const els = ['#donkeySection','#dilSection','#theaterSection','#pieSection','#lettersSection'];
        els.forEach((sel,idx)=>{
          const el = $(sel);
          if(el) el.style.transform = 'translateY(6px)';
        });
      }, 240);
    });
  </script>
</body>
</html>
